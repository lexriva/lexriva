<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexriva | Collections</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --cherry: #72001A; --gold: #D4AF37; --lavender: #F9F7FF; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--lavender); padding-bottom: 80px; }
        
        .header { background: #fff; padding: 15px 20px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #eee; }
        .back-btn { font-size: 24px; color: var(--cherry); cursor: pointer; font-weight: 900; margin-right: 15px; }
        .page-title { font-family: 'Cinzel'; font-size: 14px; font-weight: 900; color: var(--cherry); flex-grow: 1; text-align: center; letter-spacing: 2px; }

        .p-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .p-card { background: #fff; border-radius: 15px; padding: 8px; text-align: center; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; }
        .p-card img { width: 100%; height: 210px; object-fit: cover; border-radius: 12px; }
        .p-card h3 { font-size: 10px; margin: 8px 0 4px; color: #333; height: 25px; overflow: hidden; font-weight: 600; text-transform: uppercase; }
        
        .price-row { display: flex; justify-content: center; align-items: center; gap: 6px; }
        .price { font-weight: 800; color: var(--cherry); font-size: 14px; }
        .old-p { font-size: 10px; color: #999; text-decoration: line-through; }

        /* Wishlist Heart Icon */
        .wish-heart { position: absolute; top: 15px; right: 15px; background: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1); color: #ddd; font-size: 18px; transition: 0.3s; }
        .wish-heart.active { color: red; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-btn { font-size: 10px; font-weight: 800; color: #bbb; text-align: center; text-decoration: none; }
    </style>
</head>
<body>

    <div class="header">
        <div class="back-btn" onclick="history.back()">‚Üê</div>
        <div class="page-title" id="listTitle">COLLECTION</div>
    </div>

    <div id="productGrid" class="p-grid">
        </div>

    <div class="bottom-nav">
        <a href="index.html" class="nav-btn">üè†<br>HOME</a>
        <a href="category.html" class="nav-btn">üëó<br>CATEGORY</a>
        <a href="wishlist.html" class="nav-btn">üíñ<br>WISHLIST</a>
        <a href="bag.html" class="nav-btn">üõçÔ∏è<br>BAG</a>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbyJbLc033WEF7htCF5LYhBF3jC-2YKhLV-SE-MsQYLVQR18ZQN_kWtDrd44EEzB7JB4/exec";

        async function init() {
            const sub = localStorage.getItem('activeSubCat') || 'Collection';
            document.getElementById('listTitle').innerText = sub.replace('under', 'UNDER ').toUpperCase();

            try {
                const res = await fetch(API);
                const data = await res.json();
                let filteredList = [];

                Object.keys(data).forEach(sheetName => {
                    if(Array.isArray(data[sheetName])) {
                        data[sheetName].forEach((p, index) => {
                            let match = false;
                            const price = parseInt(p.p);

                            // Price Filter (Under 499, etc)
                            if(sub === 'under499' && price <= 499) match = true;
                            else if(sub === 'under999' && price <= 999) match = true;
                            else if(sub === 'under1499' && price <= 1499) match = true;
                            
                            // Sub-Category Filter (Saree, Makeup, etc)
                            else if(p.subCat && p.subCat.trim().toLowerCase() === sub.toLowerCase()) match = true;
                            else if(p.n && p.n.toLowerCase().includes(sub.toLowerCase())) match = true;

                            if(match) {
                                filteredList.push({...p, sName: sheetName, sIdx: index});
                            }
                        });
                    }
                });

                renderGrid(filteredList);
            } catch (e) { console.error("Error loading products"); }
        }

        function renderGrid(list) {
            const grid = document.getElementById('productGrid');
            let wish = JSON.parse(localStorage.getItem('lexWish')) || [];

            if(list.length === 0) {
                grid.innerHTML = "<p style='grid-column: span 2; text-align:center; padding:50px; color:#888;'>No products found in this category.</p>";
                return;
            }

            grid.innerHTML = list.map(p => {
                const isWished = wish.some(x => x.n === p.n) ? 'active' : '';
                return `
                <div class="p-card" onclick="openDetail('${p.sName}', ${p.sIdx})">
                    <div class="wish-heart ${isWished}" onclick="event.stopPropagation(); toggleWish(this, '${p.n}', '${p.p}', '${p.i}')">‚ô•</div>
                    <img src="${p.i}">
                    <h3>${p.n}</h3>
                    <div class="price-row">
                        <span class="price">‚Çπ${p.p}</span>
                        <span class="old-p">‚Çπ${Math.round(p.p * 1.6)}</span>
                    </div>
                </div>`;
            }).join('');
        }

        function toggleWish(btn, n, p, i) {
            let wish = JSON.parse(localStorage.getItem('lexWish')) || [];
            const idx = wish.findIndex(x => x.n === n);
            if(idx > -1) { 
                wish.splice(idx, 1); 
                btn.classList.remove('active'); 
            } else { 
                wish.push({n, p, i}); 
                btn.classList.add('active'); 
            }
            localStorage.setItem('lexWish', JSON.stringify(wish));
        }

        function openDetail(sheet, idx) {
            localStorage.setItem('targetSheet', sheet);
            localStorage.setItem('targetIdx', idx);
            window.location.href = "product.html";
        }

        window.onload = init;
    </script>
</body>
</html>

