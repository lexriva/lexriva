<script>
    const API = "https://script.google.com/macros/s/AKfycbyJbLc033WEF7htCF5LYhBF3jC-2YKhLV-SE-MsQYLVQR18ZQN_kWtDrd44EEzB7JB4/exec";

    async function loadHome() {
        try {
            const res = await fetch(API);
            const data = await res.json();
            console.log("Sheet Data Received:", data); // Check karne ke liye

            // 1. Trending Reels (Trending Sheet)
            if(data.Trending || data.trending) {
                const trendingData = data.Trending || data.trending;
                document.getElementById('trending-reels').innerHTML = trendingData.map((v, i) => `
                    <div class="reel-card" onclick="openProduct('Trending', ${i})">
                        <video src="${v.v}" autoplay muted loop playsinline></video>
                    </div>`).join('');
            }

            // 2. THE EID EDIT (Eid Sheet) - Fixing the display issue
            const eidData = data.Eid || data.eid; // Dono check karega small aur capital
            if(eidData && eidData.length > 0) {
                document.getElementById('eid-scroll').innerHTML = eidData.map((p, i) => `
                    <div class="product-item" onclick="openProduct('Eid', ${i})">
                        <img src="${p.i}" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="price">₹${p.p}</div>
                    </div>`).join('');
            } else {
                document.getElementById('eid-scroll').innerHTML = "<p style='padding:20px;'>Products are being updated...</p>";
            }

            // 3. BESTSELLERS (Bestseller Sheet)
            const bestData = data.Bestseller || data.bestseller || data.best;
            if(bestData && bestData.length > 0) {
                document.getElementById('best-scroll').innerHTML = bestData.map((p, i) => `
                    <div class="product-item" onclick="openProduct('Bestseller', ${i})">
                        <img src="${p.i}" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="price">₹${p.p}</div>
                    </div>`).join('');
            } else {
                document.getElementById('best-scroll').innerHTML = "<p style='padding:20px;'>New styles coming soon!</p>";
            }

        } catch (e) { 
            console.error("Load Error:", e);
            document.getElementById('eid-scroll').innerHTML = "Please check your internet or API connection.";
        }
    }

    function openProduct(sheet, idx) {
        localStorage.setItem('targetSheet', sheet);
        localStorage.setItem('targetIdx', idx);
        window.location.href = "product.html";
    }

    function goStory(limit) { 
        localStorage.setItem('filterPrice', limit); 
        window.location.href = "product_list.html"; 
    }

    function goCat(name) { 
        localStorage.setItem('selectedCat', name); 
        window.location.href = "category.html"; 
    }

    function toggleOverlay(id) { 
        const el = document.getElementById(id); 
        el.style.display = (el.style.display === 'block') ? 'none' : 'block'; 
    }
    
    window.onload = loadHome;
</script>
