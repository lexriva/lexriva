<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexriva | Categories</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --cherry: #72001A; --gold: #D4AF37; --lavender: #F4EFFF; --white: #ffffff; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--lavender); overflow-x: hidden; }
        
        .header { background: #fff; padding: 15px 20px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #eee; }
        .back-btn { font-size: 20px; color: var(--cherry); cursor: pointer; text-decoration: none; font-weight: 900; }
        .page-title { font-family: 'Cinzel'; font-size: 16px; font-weight: 900; color: var(--cherry); flex-grow: 1; text-align: center; letter-spacing: 2px; }

        /* Sub-Category Circular Grid */
        .sub-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; align-items: center; }
        .sub-item { text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .sub-item img { width: 85px; height: 85px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 8px; transition: 0.3s; }
        .sub-item p { font-size: 9px; font-weight: 800; color: #444; text-transform: uppercase; letter-spacing: 1px; }
        
        /* The Iconic Cherry Box */
        .cherry-box { background: var(--cherry); color: var(--gold); border-radius: 120px 120px 10px 10px; width: 100px; height: 140px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-family: 'Cinzel'; border: 2px solid var(--gold); grid-column: span 1; justify-self: center; box-shadow: 0 8px 20px rgba(114,0,26,0.2); }

        /* Product Grid */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .p-card { background: #fff; border-radius: 15px; padding: 10px; text-align: center; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; }
        .p-card img { width: 100%; height: 180px; object-fit: cover; border-radius: 12px; }
        .p-card h3 { font-size: 11px; margin: 8px 0 4px; color: #333; height: 30px; overflow: hidden; }
        .price { font-weight: 800; color: var(--cherry); font-size: 14px; }
        
        .wish-icon { position: absolute; top: 15px; right: 15px; color: #ddd; font-size: 18px; }
        .wish-icon.active { color: red; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-btn { font-size: 9px; font-weight: 800; color: #999; text-align: center; cursor: pointer; text-decoration: none; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="back-btn">‚Üê</a>
        <div class="page-title" id="catTitle">COLLECTION</div>
    </div>

    <div id="subGridContainer" class="sub-grid">
        </div>

    <div class="section-h" style="padding: 15px; font-size: 11px; font-weight: 800; color: var(--cherry); text-align: center; border-top: 1px solid #eee;">
        ‚ú® EXPLORE PRODUCTS
    </div>

    <div id="pListGrid" class="product-grid">
        </div>

    <div class="bottom-nav">
        <a href="index.html" class="nav-btn">üè†<br>HOME</a>
        <a href="category.html" class="nav-btn" style="color: var(--cherry);">üëó<br>CATEGORY</a>
        <a href="wishlist.html" class="nav-btn">üíñ<br>WISHLIST</a>
        <a href="login.html" class="nav-btn">üë§<br>LOGIN</a>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbwdDAiEuLykJJPxRK7Gh89yF-Pmyf71RKMGTh83j-SYe4AGKuqMR1zY9UcrKQbnoFU/exec";
        
        const subData = {
            'western': ['Dresses','Tops','Jeans','Co-ords','Jumpsuits','T-shirts','Jackets','Skirts','Shorts','Blazers'],
            'ethnic': ['Saree','Kurtis','Suits','Lehenga','Anarkali','Sharara','Dupatta','Palazzo','Gowns','Ethnic Sets'],
            'makeup': ['Lipstick','Foundation','Kajal','Perfumes','Compact','Eyeliner','Primer','Blush','Mascara','Highlighter'],
            'jewel': ['Necklace','Earrings','Rings','Bangles','Bracelet','Bridal','Maangtika','Anklets','Chokers','Antique']
        };

        async function init() {
            const cat = localStorage.getItem('selectedCat') || 'western';
            document.getElementById('catTitle').innerText = cat.toUpperCase() + " MALL";
            renderSubCats(cat);
            loadProducts(cat);
        }

        function renderSubCats(cat) {
            let list = subData[cat] || [];
            let html = "";
            list.forEach((name, idx) => {
                // Insert Cherry Box exactly at 5th position
                if(idx === 4) {
                    html += `<div class="cherry-box"><span style="font-size:8px">ESTD. 2024</span><br><span style="font-size:14px;letter-spacing:1px">LEXRIVA</span></div>`;
                }
                html += `
                    <div class="sub-item" onclick="filterBySub('${name}')">
                        <img src="${name.toLowerCase().replace(/ /g,'_')}.jpg" onerror="this.src='https://via.placeholder.com/80?text=${name}'">
                        <p>${name}</p>
                    </div>`;
            });
            document.getElementById('subGridContainer').innerHTML = html;
        }

        async function loadProducts(cat) {
            const res = await fetch(API);
            const data = await res.json();
            window.allProducts = data;
            displayProducts(data.latest || []); // Default view
        }

        function displayProducts(list) {
            document.getElementById('pListGrid').innerHTML = list.map((p, i) => `
                <div class="p-card" onclick="openProductDetail('${p.n}')">
                    <span class="wish-icon">‚ô•</span>
                    <img src="${p.i}">
                    <h3>${p.n}</h3>
                    <div class="price">‚Çπ${p.p}</div>
                </div>
            `).join('');
        }

        function filterBySub(subName) {
            let filtered = [];
            Object.keys(window.allProducts).forEach(sheet => {
                if(Array.isArray(window.allProducts[sheet])) {
                    filtered = filtered.concat(window.allProducts[sheet].filter(p => p.subCat && p.subCat.trim() === subName));
                }
            });
            displayProducts(filtered.length ? filtered : []);
        }

        function openProductDetail(pName) {
            localStorage.setItem('selectedProductName', pName);
            window.location.href = "product.html";
        }

        window.onload = init;
    </script>
</body>
</html>

